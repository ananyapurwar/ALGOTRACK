<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <title>AlgoTrack</title>
  <meta name="description" content="Visualize and compare Codeforces user profiles">
  <meta name="theme-color" content="#ffd700" />
  <link rel="manifest" href="manifest.json" />
  <link rel="shortcut icon" href="images/favicon.png">

  <!-- Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en&display=swap">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons&display=swap">
  <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.amber-yellow.min.css">
  <link rel="stylesheet" href="styles/style.css">
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script src="https://code.getmdl.io/1.3.0/material.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="js/compare_helper.js"></script>
  <script src="js/compare.js"></script>
</head>

<body>
  <div class="layout mdl-layout mdl-js-layout mdl-layout--fixed-drawer mdl-layout--fixed-header">
    <header class="header mdl-layout__header mdl-color--grey-100 mdl-color-text--grey-600">
      <div class="mdl-layout__header-row">
        <span class="mdl-layout-title">AlgoTrack</span>
        <div class="mdl-layout-spacer"></div>
        <nav class="mdl-navigation mdl-layout--large-screen-only">
          <a href="index.html" class="mdl-button mdl-js-button mdl-js-ripple-effect"><i class="mdl-color-text--blue-grey-400 material-icons" role="presentation">home</i> Home <span class="mdl-ripple"></span></a>
          <a href="compare.html" class="mdl-button mdl-js-button mdl-js-ripple-effect"><i class="mdl-color-text--blue-grey-400 material-icons" role="presentation">compare</i> Compare<span class="mdl-ripple"></span></a>
          <a href="#" id="loginBtn" class="mdl-button mdl-js-button mdl-js-ripple-effect"><i class="mdl-color-text--blue-grey-400 material-icons" role="presentation">account_circle</i> Login <span class="mdl-ripple"></span></a>
          <a href="#" id="adminBtn" class="mdl-button mdl-js-button mdl-js-ripple-effect hidden"><i class="mdl-color-text--blue-grey-400 material-icons" role="presentation">admin_panel_settings</i> Admin <span class="mdl-ripple"></span></a>
          <a href="#" id="logoutBtn" class="mdl-button mdl-js-button mdl-js-ripple-effect hidden"><i class="mdl-color-text--blue-grey-400 material-icons" role="presentation">exit_to_app</i> Logout <span class="mdl-ripple"></span></a>
        </nav>
      </div>
    </header>
    <div class="mdl-layout__drawer mdl-layout--small-screen-only">
      <span id='logo'>CFV</span>
      <nav class="navigation mdl-navigation">
        <a href="index.html" class="mdl-navigation__link"><i class="mdl-color-text--blue-grey-400 material-icons" role="presentation">home</i> Home </a>
        <a href="compare.html" class="mdl-navigation__link"><i class="mdl-color-text--blue-grey-400 material-icons" role="presentation">compare</i> Compare</a>
        <a href="#" id="loginBtnMobile" class="mdl-navigation__link"><i class="mdl-color-text--blue-grey-400 material-icons" role="presentation">account_circle</i> Login</a>
        <a href="#" id="adminBtnMobile" class="mdl-navigation__link hidden"><i class="mdl-color-text--blue-grey-400 material-icons" role="presentation">admin_panel_settings</i> Admin</a>
        <a href="#" id="logoutBtnMobile" class="mdl-navigation__link hidden"><i class="mdl-color-text--blue-grey-400 material-icons" role="presentation">exit_to_app</i> Logout</a>
      </nav>
    </div>
    <main class="mdl-layout__content mdl-color--grey-100">
      <div id="mainSpinner" class="mdl-spinner mdl-js-spinner"></div>
      <div class="mdl-grid content">
        <div class="handle-card mdl-color--white mdl-shadow--2dp mdl-cell mdl-cell--9-col">
          <form action="" id="handleform">
            <div class="mdl-textfield mdl-js-textfield" id="handle1Div">
              <input type="text" class="mdl-textfield__input" name="handle1" id="handle1">
              <label class="mdl-textfield__label" for="handle1">Handle 1</label>
              <span id="handle1DivErr" class="mdl-textfield__error">Couldn't find user. Network problem?</span>
            </div>
            <div class="mdl-textfield mdl-js-textfield" id="handle2Div">
              <input type="text" class="mdl-textfield__input" name="handle2" id="handle2">
              <label class="mdl-textfield__label" for="handle2">Handle 2</label>
              <span id="handle2DivErr" class="mdl-textfield__error">Couldn't find user. Network problem?</span>
            </div>
            <br>
            <button id="submitButton" type="submit" class="mdl-button mdl-button--raised mdl-js-button">Compare</button>
          </form>
        </div>
        <div id="ratings" class="hidden to-hide to-clear card mdl-shadow--2dp mdl-cell mdl-cell--4-col mdl-cell--8-col-desktop">
        </div>
        <div id="contestsCount" class="hidden to-hide to-clear card mdl-shadow--2dp mdl-cell mdl-cell--4-col">
        </div>
        <div id="upDowns" class="hidden to-hide to-clear card mdl-shadow--2dp mdl-cell mdl-cell--4-col mdl-cell--6-col-desktop">
        </div>
        <div id="bestWorst" class="hidden to-hide card mdl-shadow--2dp mdl-cell mdl-cell--8-col">
          <table class="mdl-data-table mdl-js-data-table mdl-shadow--2dp">
            <thead>
              <tr class="mdl-color--amber-700">
                <th class="mdl-data-table__cell--non-numeric">Worst and Best</th>
                <th id="user1"></th>
                <th id="user2"></th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="mdl-data-table__cell--non-numeric">Best</td>
                <td id="user1Best"></td>
                <td id="user2Best"></td>
              </tr>
              <tr>
                <td class="mdl-data-table__cell--non-numeric">Worst</td>
                <td id="user1Worst"></td>
                <td id="user2Worst"></td>
              </tr>
            </tbody>
          </table>
        </div>
        <div id="timelineCon" class="hidden card to-hide mdl-shadow--2dp mdl-cell mdl-cell--8-col mdl-cell--12-col-desktop">
          <div class="to-clear" id="timeline"></div>
        </div>
        <div id="solvedTried" class="hidden card to-clear to-hide mdl-shadow--2dp mdl-cell mdl-cell--4-col">
        </div>
        <div id="unsolved" class="hidden card to-clear to-hide mdl-shadow--2dp mdl-cell mdl-cell--4-col">
        </div>
        <div id="averageSub" class="hidden card to-clear to-hide mdl-shadow--2dp mdl-cell mdl-cell--4-col">
        </div>
        <span class="mdl-tooltip" for="averageSub">Average submissions they had to make to solve a single problem</span>
        <div id="maxSub" class="hidden card to-clear to-hide mdl-shadow--2dp mdl-cell mdl-cell--4-col">
        </div>
        <span class="mdl-tooltip" for="maxSub">Maximum submissions they had to make to solve a single problem</span>
        <div id="oneSub" class="hidden card to-clear to-hide mdl-shadow--2dp mdl-cell mdl-cell--4-col">
        </div>
        <span class="mdl-tooltip" for="oneSub">Percentage of problems they've solved with just one submission</span>
        <div id="maxAc" class="hidden card to-clear to-hide mdl-shadow--2dp mdl-cell mdl-cell--4-col">
        </div>
        <div id="commonSolvedTable" class="hidden to-hide card mdl-shadow--2dp mdl-cell mdl-cell--8-col">
          <table class="mdl-data-table mdl-js-data-table mdl-shadow--2dp">
            <thead>
              <tr class="mdl-color--amber-700">
                <th class="mdl-data-table__cell--non-numeric">Common Solved</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td id="commonSolved" class="mdl-data-table__cell--non-numeric"></td>
              </tr>
            </tbody>
          </table>
        </div>
        <div id="levels" class="hidden card to-clear to-hide mdl-shadow--2dp mdl-cell mdl-cell--12-col">
        </div>
        <div id="pRatings" class="hidden card to-clear to-hide mdl-shadow--2dp mdl-cell mdl-cell--12-col">
        </div>
        <div id="tags" class="hidden card to-clear to-hide mdl-shadow--2dp mdl-cell mdl-cell--12-col">
        </div>
        <div id="commonContestsCon" class="hidden to-hide card mdl-shadow--2dp mdl-cell mdl-cell--12-col">
          <table class="mdl-data-table mdl-js-data-table mdl-shadow--2dp">
            <thead>
              <tr class="mdl-color--amber-700">
                <th class="mdl-data-table__cell--non-numeric">Common contests</th>
                <th id="user1Con"></th>
                <th id="user2Con"></th>
                <th>Distance</th>
              </tr>
            </thead>
            <tbody id="commonContestList" class="to-clear">
            </tbody>
          </table>
        </div>

      </div>
    </main>
  </div>

  <script>
  // Check authentication status
  $(document).ready(function() {
    $.ajax({
      url: '/api/user',
      method: 'GET',
      success: function(data) {
        if (data.isAuthenticated) {
          // User is logged in
          $('#loginBtn, #loginBtnMobile').addClass('hidden');
          $('#logoutBtn, #logoutBtnMobile').removeClass('hidden');

          // Check if user is admin
          if (data.user.isAdmin) {
            $('#adminBtn, #adminBtnMobile').removeClass('hidden');
          }

          // If user has a handle, set it in the handle1 input
          if (data.user.handle) {
            $('#handle1').val(data.user.handle);
            $('#handle1Div').addClass('is-dirty');
          }
        } else {
          // User is not logged in
          $('#loginBtn, #loginBtnMobile').removeClass('hidden');
          $('#logoutBtn, #logoutBtnMobile, #adminBtn, #adminBtnMobile').addClass('hidden');
        }
      },
      error: function() {
        // Default to logged out state on error
        $('#loginBtn, #loginBtnMobile').removeClass('hidden');
        $('#logoutBtn, #logoutBtnMobile, #adminBtn, #adminBtnMobile').addClass('hidden');
      }
    });

    // Set up button click handlers
    $('#loginBtn, #loginBtnMobile').click(function(e) {
      e.preventDefault();
      window.location.href = '/login.html';
    });

    $('#logoutBtn, #logoutBtnMobile').click(function(e) {
      e.preventDefault();
      window.location.href = '/logout';
    });

    $('#adminBtn, #adminBtnMobile').click(function(e) {
      e.preventDefault();
      window.location.href = '/admin';
    });
  });
  </script>
</body>

</html>
